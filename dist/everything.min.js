angular.module("myApp",[]).factory("gameLogic",function(){"use strict";function a(a,b){return angular.equals(a,b)}function b(a){return angular.copy(a)}function c(){var a,b,c=[];for(a=0;10>a;a+=1)for(c[a]=[],b=0;10>b;b+=1)c[a][b]="";return c[0][3]="A",c[0][6]="A",c[3][0]="A",c[3][9]="A",c[6][0]="B",c[6][9]="B",c[9][3]="B",c[9][6]="B",c}function d(){var a=c();return{turnInfo:{ctr:2,pawn:"A"},pawnDelta:{row:"",col:""},board:a}}function e(a,b,c){var d,e,f={rowFrom:0,rowTo:0,colFrom:0,colTo:0};for(f=0===a&&0===b?{rowFrom:0,rowTo:1,colFrom:0,colTo:1}:0===a&&9===b?{rowFrom:0,rowTo:1,colFrom:8,colTo:9}:9===a&&0===b?{rowFrom:8,rowTo:9,colFrom:0,colTo:1}:9===a&&9===b?{rowFrom:8,rowTo:9,colFrom:8,colTo:9}:0===a&&b>0&&9>b?{rowFrom:0,rowTo:1,colFrom:b-1,colTo:b+1}:a>0&&9>a&&0===b?{rowFrom:a-1,rowTo:a+1,colFrom:0,colTo:1}:9===a&&b>0&&9>b?{rowFrom:8,rowTo:9,colFrom:b-1,colTo:b+1}:a>0&&9>a&&9===b?{rowFrom:a-1,rowTo:a+1,colFrom:8,colTo:9}:{rowFrom:a-1,rowTo:a+1,colFrom:b-1,colTo:b+1},d=f.rowFrom;d<=f.rowTo;d+=1)for(e=f.colFrom;e<=f.colTo;e+=1)if(""===c[d][e])return 1;return 0}function f(a,b){var c,d,f=0,g=0;for(c=0;10>c;c+=1)for(d=0;10>d;d+=1)"A"===a[c][d]?f+=e(c,d,a):"B"===a[c][d]&&(g+=e(c,d,a));return"A"===b&&0===g?"A":"B"===b&&0===f?"B":""}function g(a,c,e,g){if("{}"===g)g=d();else{var h=angular.fromJson(g);g=h}0===e&&(e={turnIndex:0}),1===e&&(e={turnIndex:1});var i,j,k=g.board,l=g.turnInfo,m=e,n=l,o=a,p=c,q=b(k);if(""!==k[c.row][c.col])throw new Error("pawn must land in empty position");if(2===l.ctr){if(k[a.row][a.col]!==l.pawn)throw new Error("pawn has to exist at position");q[a.row][a.col]=""}if(1===l.ctr){if(a.row!==g.pawnDelta.row||a.col!==g.pawnDelta.col)throw new Error("Wrong position for shooting arrow");if(0===e.turnIndex&&"A"!==k[a.row][a.col]||1===e.turnIndex&&"B"!==k[a.row][a.col])throw new Error("player has to shoot arrow from the same place")}if(q[c.row][c.col]=l.pawn,1===l.ctr){if(i=f(q,q[a.row][a.col]),""!==i){j={endMatch:{endMatchScores:"A"===i?[1,0]:"B"===i?[0,1]:[0,0]}},n={ctr:"",pawn:""};var r="A"===i?"Game Over! White player wins":"Game over! Black Player wins";return window.alert(r),[j,{set:{key:"turnInfo",value:n}},{set:{key:"pawnPosition",value:{row:o.row,col:o.col}}},{set:{key:"pawnDelta",value:{row:p.row,col:p.col}}},{set:{key:"board",value:q}}]}0===e.turnIndex?(m.turnIndex=1,n.ctr=2,n.pawn="B"):1===e.turnIndex&&(m.turnIndex=0,n.ctr=2,n.pawn="A")}else n.ctr=1,n.pawn="X";return[{setTurn:m},{set:{key:"turnInfo",value:n}},{set:{key:"pawnPosition",value:{row:o.row,col:o.col}}},{set:{key:"pawnDelta",value:{row:p.row,col:p.col}}},{set:{key:"board",value:q}}]}function h(a,b,c){var d,e,f;if(0!==Math.abs(a.row-b.row))return!1;if(b.col>a.col){for(e=b,f=a,d=f.col+1;d<=e.col;d+=1)if(""!==c[e.row][d])return!1}else for(e=a,f=b,d=e.col-1;d>=f.col;d-=1)if(""!==c[e.row][d])return!1;return!0}function i(a,b,c){var d,e,f;if(0!==Math.abs(a.col-b.col))return!1;if(b.row>a.row){for(d=b,e=a,f=e.row+1;f<=d.row;f+=1)if(""!==c[f][d.col])return!1}else for(d=a,e=b,f=d.row-1;f>=e.row;f-=1)if(""!==c[f][d.col])return!1;return!0}function j(a,b,c){var d,e,f,g;if(Math.abs(a.row-b.row)!==Math.abs(a.col-b.col))return!1;if(d=b,e=a,b.col>a.col&&b.row<a.row)for(f=e.row-1,g=e.col+1;f>=d.row&&g<=d.col;){if(""!==c[f][g])return!1;f-=1,g+=1}else if(b.col>a.col&&b.row>a.row)for(f=e.row+1,g=e.col+1;f<=d.row&&g<=d.col;){if(""!==c[f][g])return!1;f+=1,g+=1}else if(b.col<a.col&&b.row>a.row)for(f=e.row+1,g=e.col-1;f<=d.row&&g>=d.col;){if(""!==c[f][g])return!1;f+=1,g-=1}else if(b.col<a.col&&b.row<a.row)for(f=e.row-1,g=e.col-1;f>=d.row&&g>=d.col;){if(""!==c[f][g])return!1;f-=1,g-=1}return!0}function k(){var a=[{turnIndexBeforeMove:{turnIndex:0},stateBeforeMove:{turnInfo:{ctr:2,pawn:"A"},pawnDelta:{row:"",col:""},board:[["","","","A","","","A","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["A","","","","","","","","","A"],["","","","","","","","","",""],["","","","","","","","","",""],["B","","","","","","","","","B"],["","","","","","","","","",""],["","","","","","","","","",""],["","","","B","","","B","","",""]]},move:[{setTurn:{turnIndex:0}},{set:{key:"turnInfo",value:{ctr:1,pawn:"X"}}},{set:{key:"pawnPosition",value:{row:0,col:3}}},{set:{key:"pawnDelta",value:{row:0,col:4}}},{set:{key:"board",value:[["","","","","A","","A","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["A","","","","","","","","","A"],["","","","","","","","","",""],["","","","","","","","","",""],["B","","","","","","","","","B"],["","","","","","","","","",""],["","","","","","","","","",""],["","","","B","","","B","","",""]]}}],comment:"player 0 starts and moves his pawn from (0,3) to (0,4)"},{turnIndexBeforeMove:{turnIndex:0},stateBeforeMove:{turnInfo:{ctr:1,pawn:"X"},pawnDelta:{row:0,col:4},board:[["","","","","A","","A","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["A","","","","","","","","","A"],["","","","","","","","","",""],["","","","","","","","","",""],["B","","","","","","","","","B"],["","","","","","","","","",""],["","","","","","","","","",""],["","","","B","","","B","","",""]]},move:[{setTurn:{turnIndex:1}},{set:{key:"turnInfo",value:{ctr:2,pawn:"B"}}},{set:{key:"pawnPosition",value:{row:0,col:4}}},{set:{key:"pawnDelta",value:{row:9,col:4}}},{set:{key:"board",value:[["","","","","A","","A","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["A","","","","","","","","","A"],["","","","","","","","","",""],["","","","","","","","","",""],["B","","","","","","","","","B"],["","","","","","","","","",""],["","","","","","","","","",""],["","","","B","X","","B","","",""]]}}],comment:"player 0 shoots arrow from (0,4) to (9,4)"},{turnIndexBeforeMove:{turnIndex:1},stateBeforeMove:{turnInfo:{ctr:2,pawn:"B"},pawnDelta:{row:9,col:4},board:[["","","","","A","","A","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["A","","","","","","","","","A"],["","","","","","","","","",""],["","","","","","","","","",""],["B","","","","","","","","","B"],["","","","","","","","","",""],["","","","","","","","","",""],["","","","B","X","","B","","",""]]},move:[{setTurn:{turnIndex:1}},{set:{key:"turnInfo",value:{ctr:1,pawn:"X"}}},{set:{key:"pawnPosition",value:{row:6,col:0}}},{set:{key:"pawnDelta",value:{row:9,col:0}}},{set:{key:"board",value:[["","","","","A","","A","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["A","","","","","","","","","A"],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","","B"],["","","","","","","","","",""],["","","","","","","","","",""],["B","","","B","X","","B","","",""]]}}],comment:"player 1 now has the turn and moves his pawn from (6,0) to (9,0)"},{turnIndexBeforeMove:{turnIndex:1},stateBeforeMove:{turnInfo:{ctr:1,pawn:"X"},pawnDelta:{row:9,col:0},board:[["","","","","A","","A","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["A","","","","","","","","","A"],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","","B"],["","","","","","","","","",""],["","","","","","","","","",""],["B","","","B","X","","B","","",""]]},move:[{setTurn:{turnIndex:0}},{set:{key:"turnInfo",value:{ctr:2,pawn:"A"}}},{set:{key:"pawnPosition",value:{row:9,col:0}}},{set:{key:"pawnDelta",value:{row:4,col:0}}},{set:{key:"board",value:[["","","","","A","","A","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["A","","","","","","","","","A"],["X","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","","B"],["","","","","","","","","",""],["","","","","","","","","",""],["B","","","B","X","","B","","",""]]}}],comment:"player 1 shoots arrow from (9,0) to (4,0)"},{turnIndexBeforeMove:{turnIndex:0},stateBeforeMove:{turnInfo:{ctr:2,pawn:"A"},pawnDelta:{row:4,col:0},board:[["","","","","A","","A","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["A","","","","","","","","","A"],["X","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","","B"],["","","","","","","","","",""],["","","","","","","","","",""],["B","","","B","X","","B","","",""]]},move:[{setTurn:{turnIndex:0}},{set:{key:"turnInfo",value:{ctr:1,pawn:"X"}}},{set:{key:"pawnPosition",value:{row:0,col:6}}},{set:{key:"pawnDelta",value:{row:0,col:9}}},{set:{key:"board",value:[["","","","","A","","","","","A"],["","","","","","","","","",""],["","","","","","","","","",""],["A","","","","","","","","","A"],["X","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","","B"],["","","","","","","","","",""],["","","","","","","","","",""],["B","","","B","X","","B","","",""]]}}],comment:"player 0 moves his pawn from (0,6) to (0,9)"}];return a}function l(){var a=[{turnIndexBeforeMove:{turnIndex:1},stateBeforeMove:{turnInfo:{ctr:2,pawn:"B"},pawnDelta:{row:"0",col:"2"},board:[["","","X","A","X","X","A","X","",""],["","","X","X","","X","X","X","",""],["X","X","","","","","","","X","X"],["A","X","","","","","","","X","A"],["X","X","","","","X","","X","X","X"],["X","X","","","","","","","X","X"],["B","X","","","","","","","X","B"],["X","X","","","","","","","X","X"],["","","X","X","","","","","",""],["","","X","B","X","X","B","","",""]]},move:[{setTurn:{turnIndex:1}},{set:{key:"turnInfo",value:{ctr:1,pawn:"X"}}},{set:{key:"pawnPosition",value:{row:9,col:3}}},{set:{key:"pawnDelta",value:{row:8,col:4}}},{set:{key:"board",value:[["","","X","A","X","X","A","X","",""],["","","X","X","","X","X","X","",""],["X","X","","","","","","","X","X"],["A","X","","","","","","","X","A"],["X","X","","","","X","","X","X","X"],["X","X","","","","","","","X","X"],["B","X","","","","","","","X","B"],["X","X","","","","","","","X","X"],["","","X","X","B","","","","",""],["","","X","","X","X","B","","",""]]}}],comment:"if B plays a combination of pawn move from 9,3 to 8,4 and then arrow move from 8,4 to 1,4 : B wins"},{turnIndexBeforeMove:{turnIndex:0},stateBeforeMove:{turnInfo:{ctr:2,pawn:"A"},pawnDelta:{row:"9",col:"3"},board:[["X","","X","","X","X","A","X","",""],["","","X","X","","X","X","X","",""],["X","X","","","X","","X","","X","X"],["A","","","X","A","","","","X","A"],["X","X","","","","X","","X","X","X"],["X","","","","X","","","","X","X"],["B","X","","","","","B","","X",""],["X","X","","","","","","","X","X"],["","","X","X","","","","","",""],["X","","X","B","X","X","B","","",""]]},move:[{setTurn:{turnIndex:0}},{set:{key:"turnInfo",value:{ctr:1,pawn:"X"}}},{set:{key:"pawnPosition",value:{row:3,col:4}}},{set:{key:"pawnDelta",value:{row:5,col:2}}},{set:{key:"board",value:[["X","","X","","X","X","A","X","",""],["","","X","X","","X","X","X","",""],["X","X","","","X","","X","","X","X"],["A","","","X","","","","","X","A"],["X","X","","","","X","","X","X","X"],["X","","A","","X","","","","X","X"],["B","X","","","","","B","","X",""],["X","X","","","","","","","X","X"],["","","X","X","","","","","",""],["X","","X","B","X","X","B","","",""]]}}],comment:"A moves to 5,2 and can block off pawn B at 6,0 completely by playing his arrow to 5,1"}];return a}function m(a,b){var c=angular.fromJson(a);a=c;var d,e,f,h,i=[],j={1:[],2:[],3:[],4:[]},k=1,l=a.board,m=a.turnInfo;if(2===m.ctr){for(f=0;10>f;f+=1)for(h=0;10>h;h+=1)if(0===b&&"A"===l[f][h]||1===b&&"B"===l[f][h]){var n={row:f,col:h};i.push(n)}}else i.push(a.pawnDelta);for(console.log(i),f=0;f<i.length;f+=1){var o=i[f];for(h=o.col+1;10>h&&""===l[o.row][h];h+=1)c={row:o.row,col:h},j[k].push(c);for(h=o.col-1;h>=0&&""===l[o.row][h];h-=1)c={row:o.row,col:h},j[k].push(c);for(h=o.row+1;10>h&&""===l[h][o.col];h+=1)c={row:h,col:o.col},j[k].push(c);for(h=o.row-1;h>=0&&""===l[h][o.col];h-=1)c={row:h,col:o.col},j[k].push(c);for(var p=o.row+1,q=o.col+1;10>p&&10>q&&""===l[p][q];)c={row:p,col:q},j[k].push(c),p+=1,q+=1;for(p=o.row+1,q=o.col-1;10>p&&q>=0&&""===l[p][q];)c={row:p,col:q},j[k].push(c),p+=1,q-=1;for(p=o.row-1,q=o.col+1;p>=0&&10>q&&""===l[p][q];)c={row:p,col:q},j[k].push(c),p-=1,q+=1;for(p=o.row-1,q=o.col-1;p>=0&&q>=0&&""===l[p][q];)c={row:p,col:q},j[k].push(c),p-=1,q-=1;k+=1}for(var r,s,t,u;;)if(r=2===m.ctr?Math.floor(4*Math.random()+1):1,d=i[r-1],s=j[r].length,0!==s)break;t=Math.floor(Math.random()*s),u=j[r],e=u[t],console.log(d,e);var v=g(d,e,b,a);return v}function n(b){var c,e=b.move,f=b.turnIndexBeforeMove,k=b.stateBeforeMove,l=k.board;f=0===f?{turnIndex:0}:{turnIndex:1},void 0===l&&(k=d(),l=k.board);var m=e[3].set.value,n=e[2].set.value;console.log(e);try{return h(n,m,l)||i(n,m,l)||j(n,m,l)?(c=g(n,m,f,k),a(e,c)?!0:!1):!1}catch(o){return!1}}return{isMoveOk:n,createMove:g,createComputerMove:m,getInitialBoard:c,getExampleGame:k,getRiddles:l,horizontalMoveCheck:h,verticalMoveCheck:i,diagonalMoveCheck:j}}),angular.module("myApp").controller("Ctrl",["$scope","$log","$timeout","$rootScope","gameService","gameLogic","resizeGameAreaService",function(a,b,c,d,e,f,g){"use strict";function h(c,d,e){b.info([c]);var f=d-q.offsetLeft,g=e-q.offsetTop,h=z;if(0>f||0>g||f>=q.clientWidth||g>=q.clientHeight){if(b.info(["drag out"]),!t)return;var i=k();j({top:g-i.height/2,left:f-i.width/2},h),"touchend"===c&&h%2===1&&(t.style.display="none")}else{var n=Math.floor(r*f/q.clientWidth),o=Math.floor(r*g/q.clientHeight);if(b.info([f,g,n,o]),"touchstart"!==c||s||(a.board[o][n]===a.myPiece&&a.isYourTurn&&h%2===0?(s={row:o,col:n},t=document.getElementById("piece"+a.myPiece+"_"+o+"x"+n),t.style["z-index"]=++u):a.isYourTurn&&h%2===1&&(s=w,t=document.getElementById("pieceX_drag"),j(l(o,n),h),t.style["z-index"]=++u,t.style.display="inline")),!t)return;if("touchend"===c){var p=s,v={row:o,col:n};m(p,v)}else b.info(["Drag continue"]),j(l(o,n),h)}("touchend"===c||"touchcancel"===c||"touchleave"===c)&&(j(l(s.row,s.col),h),"touchend"!==c&&h%2===1&&(t.style.display="none"),s=null,t=null)}function i(b){var c=k(),d=Math.floor(b.top/c.height),e=Math.floor(b.left/c.width);return 0>d||d>9||0>e||e>9||""!==a.board[d][e]}function j(a,c){var d,e=s.row,f=s.col;b.info(["set topleft",e,f,a]),i(a)||(d=c%2===0?l(e,f):l(0,0),t.style.left=a.left-d.left+"px",t.style.top=a.top-d.top+"px")}function k(){return{width:q.clientWidth/r,height:q.clientHeight/r}}function l(a,b){var c=k();return{top:a*c.height,left:b*c.width}}function m(c,g){d.$apply(function(){var d="Dragged piece "+c.row+"x"+c.col+" to square "+g.row+"x"+g.col;if(b.info(d),a.msg=d,a.isYourTurn)try{if(f.horizontalMoveCheck(c,g,a.board)||f.verticalMoveCheck(c,g,a.board)||f.diagonalMoveCheck(c,g,a.board)){var h=f.createMove(c,g,a.turnIndex,a.jsonState);x={row:g.row,col:g.col},e.makeMove(h),a.isYourTurn=!1,w=g,z%2===1&&(t.style.display="none"),z+=1}}catch(i){b.info(["Illegal Move ",c,g])}})}function n(a){for(var b=[],c=0;a>c;c++)b.push(c);return b}function o(){e.makeMove(f.createComputerMove(a.jsonState,a.turnIndex))}function p(b){a.jsonState=angular.toJson(b.stateAfterMove,!0),a.board=b.stateAfterMove.board,a.myPiece=0===b.yourPlayerIndex?"A":"B",a.typeExpected=b.move.turnInfo?b.move.turnInfo.pawn:"A",void 0===a.board&&(a.board=f.getInitialBoard()),a.isYourTurn=b.turnIndexAfterMove>=0&&b.yourPlayerIndex===b.turnIndexAfterMove&&null===b.endMatchScores,a.turnIndex=b.turnIndexAfterMove,a.isYourTurn&&""===b.playersInfo[b.yourPlayerIndex].playerId&&(a.isYourTurn=!1,c(o,1e3))}g.setWidthToHeight(1);var q=document.getElementById("gameArea"),r=10,s=null,t=null,u=61;window.handleDragEvent=h,a.rows=n(r),a.cols=n(r),a.rowsNum=r,a.colsNum=r;var v={row:"",col:""},w={row:"",col:""},x={row:"",col:""},y=2,z=2;a.isPawn=function(b,c,d){return a.board[b][c]===d?!0:void 0},a.isNotPawn=function(b,c){return"A"===a.board[b][c]||"B"===a.board[b][c]||"X"===a.board[b][c]?!1:!0},a.isWTurn=function(){return 0===a.turnIndex?!0:!1},a.isSelected=function(a,b){return a===x.row&&b===x.col?!0:!1},a.isBTurn=function(){return 1===a.turnIndex?!0:!1},a.cellClicked=function(c,d){if(b.info(["Clicked on cell:",c,d]),a.isYourTurn&&(("A"===a.board[c][d]&&0===a.turnIndex||"B"===a.board[c][d]&&1===a.turnIndex)&&2===y?(v.row=c,v.col=d,y-=1):""===a.board[c][d]&&""!==v.row&&(w.row=c,w.col=d,f.horizontalMoveCheck(v,w,a.board)||f.verticalMoveCheck(v,w,a.board)||f.diagonalMoveCheck(v,w,a.board)?y-=1:(w.row="",w.col="",z%2===0&&(v.row="",v.col="",y=2))),0===y))try{var g=f.createMove(v,w,a.turnIndex,a.jsonState);z+=1,a.isYourTurn=!1,x={row:w.row,col:w.col},z%2!==0?(v={row:w.row,col:w.col},y=1):(v={row:"",col:""},y=2),w={row:"",col:""},e.makeMove(g)}catch(h){return void b.info(["False move",c,d])}},e.setGame({gameDeveloperEmail:"hy821@nyu.edu",minNumberOfPlayers:2,maxNumberOfPlayers:2,exampleGame:f.getExampleGame(),riddles:f.getRiddles(),isMoveOk:f.isMoveOk,updateUI:p})}]);
//# sourceMappingURL=everything.min.js.map